<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/profile.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>
    <script src="/js/form-validation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js" integrity="sha512-PEsccDx9jqX6Dh4wZDCnWMaIO3gAaU0j46W//sSqQhUQxky6/eHZyeB3NrXD2xsyugAKd4KPiDANkcuoEa2JuA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/dist/index.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/styles/minimal.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="/js/utilities.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/keys.js"></script>
    <script src="/admin/templates/loader.js"></script>
    <script>
        isAuthenticated().then(async function (is_auth) { 
            if (!is_auth) { window.location.href = "/admin/login.html"; } 
            if (!await isOperator()) { window.location.href = "/"; } 
        });
    </script>
    
    <title></title>
</head>
<body>
    <div class="d-lg-flex flex-column vh-100">
        <header>
            <div id="navbar-placeholder"></div>
        </header>
        
        <main class="mt-3 flex-fill">
            <div class="container h-100">
                <div class="row h-100">
                    <div class="col-12 col-lg-4">
                        <h1>HUB</h1>
                        <div class="position-relative top-0 start-0 h-75 w-100">
                            <div class="overflow-auto position-absolute top-0 start-0 h-100 w-100">
                                <ul class="navbar-nav" id="hub-menu-container"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-8">

                        <form id="hub-form">
                            <div class="d-flex justify-content-center">

                                <div class="w-100">
                                    <div style="height: 18rem;" class="position-relative w-100 text-end">
                                        <div class="position-absolute top-0 end-0 w-75 mt-1 me-1">
                                            <div id="map-search" class="position-relative w-100" style="z-index: 1;"></div>
                                        </div>
                                        <div id="map" class="w-100 h-100 position-absolute top-0 start-0" style="z-index: 0;"></div>
                                    </div>

                                    <div class="container-fluid mt-4">
                                        <div class="row">
                                            <div class="col-3">
                                                <div class="w-100">
                                                    <label for="data-code" class="fs-6 fw-semibold">
                                                        Codice
                                                        <span data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Ricercando il codice dell'aeroporto più vicino" aria-labelledby="arialabel-searching-airport">
                                                            <div id="arialabel-searching-airport" class="visually-hidden">
                                                                <p>Ricercando il codice dell'aeroporto più vicino.</p>
                                                                <p>Verrà automaticamente compilato il codice dell'hub se non lo hai ancora fatto</p>
                                                            </div>
                                                            <span id="search-airport-spinner" style="display: none" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                                        </span>
                                                    </label>
                                                    <input id="data-code" type="text" class="form-control" name="code">
                                                    <div id="data-code-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                            <div class="col-9">
                                                <div class="w-100">
                                                    <label for="data-name" class="fs-6 fw-semibold">Nome</label>
                                                    <input id="data-name" type="text" class="form-control" name="name">
                                                    <div id="data-name-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="w-100">
                                                    <label for="data-phone" class="fs-6 fw-semibold">Telefono</label>
                                                    <input id="data-phone" type="text" class="form-control" name="phone">
                                                    <div id="data-phone-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="w-100">
                                                    <label for="data-email" class="fs-6 fw-semibold">Email</label>
                                                    <input id="data-email" type="text" class="form-control" name="email">
                                                    <div id="data-email-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row mt-3">
                                            <div class="col-12">
                                                <div class="d-flex justify-content-center w-100">
                                                    <div id="data-address" class="position-relative w-50"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-4">
                                                <div class="w-100">
                                                    <label for="data-address-street" class="fs-6 fw-semibold">Via</label>
                                                    <input id="data-address-street" type="text" class="form-control" name="address.street">
                                                    <div id="data-address-street-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                            <div class="col-2">
                                                <div class="w-100">
                                                    <label for="data-address-number" class="fs-6 fw-semibold">Numero</label>
                                                    <input id="data-address-number" type="text" class="form-control" name="address.number">
                                                    <div id="data-address-number-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="w-100">
                                                    <label for="data-address-city" class="fs-6 fw-semibold">Città</label>
                                                    <input id="data-address-city" type="text" class="form-control" name="address.city">
                                                    <div id="data-address-city-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                            <div class="col-2">
                                                <div class="w-100">
                                                    <label for="data-address-postalcode" class="fs-6 fw-semibold">CAP</label>
                                                    <input id="data-address-postalcode" type="text" class="form-control" name="postalcode">
                                                    <div id="data-address-postalcode-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row mt-3">
                                            <div class="col-12 col-lg-8 offset-lg-2">
                                                <h2 class="form-check-label fs-6 fw-semibold">Orario lavorativo</h2>
                                                <div id="data-opening_time-feedback" class="invalid-feedback d-block" aria-live="polite"></div>
                                                
                                                <div class="accordion" id="opening_time-accordion"></div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="loading-container"></div>
</body>

<script src="./main.js"></script>
<script>
    $(document).ready(async function() {
        // Caricamento delle componenti esterne
        await Promise.all([ loadLoading($("#loading-container")), loadNavbar($("#navbar-placeholder")) ]);

        // Inizializza tooltip
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

        createWorkingTimeForm();
    });

        /* Crea il form per l'orario lavorativo */
    function createWorkingTimeForm() {
        for (const day of WEEKS) {
            $("#opening_time-accordion").append(`
                <div class="accordion-item">
                    <h3 class="accordion-header" id="${day}-heading">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${day}-collapse" aria-expanded="false" aria-controls="${day}-collapse">
                            ${TRANSLATE[day]}
                        </button>
                    </h3>
                    <div id="${day}-collapse" class="accordion-collapse collapse" aria-labelledby="${day}-heading" data-bs-parent="#opening_time-accordion">
                        <div class="accordion-body">
                            <div id="${day}-accordion-container" class="container"></div>
                            <div class="d-flex justify-content-center mb-2">
                                <button type="button" class="btn btn-outline-success" id="data-opening_time-${day}-add_slot" aria-label="Aggiungi slot lavorativo per ${TRANSLATE[day]}"><span class="button-icon">+</span></button>
                            </div>
                        </div>
                    </div>
                </div>
            `);

            $(`#data-opening_time-${day}-add_slot`).on("click", function (e) {
                addTimeSlotTo(day, "", "", "", focus=true);
            });
        }
    }
</script>

</html>